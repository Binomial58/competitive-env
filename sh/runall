#!/bin/bash

# runall
# C++: build + ioall
# Python: pyall

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

if [ $# -eq 0 ]; then
    # 引数なしの場合はカレントディレクトリ名を使う
    NAME="$(basename "$PWD")"
else
    ARG="$1"
    # 拡張子を除去
    NAME="${ARG%.cpp}"
    NAME="${NAME%.py}"
fi

if [ -f "$NAME.cpp" ]; then
    "$SCRIPT_DIR/build.sh" "$NAME" || exit 1
    if [ -x "$SCRIPT_DIR/ioall.sh" ]; then
        "$SCRIPT_DIR/ioall.sh" --nodiff
    else
        "$SCRIPT_DIR/ioall" --nodiff
    fi

elif [ -f "$NAME.py" ]; then
    "$SCRIPT_DIR/pyall.sh" --nodiff "$NAME"

else
    echo "error: $NAME.cpp or $NAME.py not found."
    exit 1
fi
